<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Celebr8 - My Orders</title>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #000;
      color: white;
    }

    nav {
      width: 100%;
      background-color: #111;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 40px;
      box-sizing: border-box;
      z-index: 10;
      position: sticky;
      top: 0;
    }

    .logo {
      font-size: 28px;
      font-weight: bold;
    }

    .nav-right ul {
      list-style: none;
      display: flex;
      gap: 25px;
      margin: 0;
      padding: 0;
    }

    .nav-right a {
      color: white;
      font-size: 16px;
      text-decoration: none;
      font-weight: bold;
    }

    .nav-right a:hover {
      color: #ffcc00;
    }

    .orders-container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      background-image: url('db.jpeg');
      background-repeat: no-repeat;
      background-position: center 100px;
      background-size: contain;
      background-attachment: fixed;
      background-color: #000;
      padding: 60px 0;
    }

    .orders-content {
      background-color: rgba(0, 0, 0, 0.6);
      padding: 40px 20px;
      width: 80vw;
      max-width: 1200px;
      box-sizing: border-box;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
    }

    .vendor-name {
      text-align: center;
      font-size: 48px;
      font-weight: 600;
      font-family: 'Dancing Script', cursive;
      margin-bottom: 40px;
      color: #fff;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.7);
    }

    h2 {
      font-size: 28px;
      margin-bottom: 10px;
      border-bottom: 2px solid #ffcc00;
      display: inline-block;
      padding-bottom: 5px;
    }

    .section {
      margin-bottom: 40px;
    }

    .section p {
      font-size: 22px;
      line-height: 1.8;
      font-weight: 500;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      color: #fff;
    }
  </style>
</head>
<body>

  <nav>
    <div class="logo">Celebr8</div>
    <div class="nav-right">
      <ul>
        <li><a href="vendorhmp.html">Home</a></li>
        <li><a href="dashboard.html">Dashboard</a></li>
        <li><a href="orders.html">My Orders</a></li>
        <li><a href="ratings.html">Customer Ratings</a></li>
        <li><a href="vendorlogin.html">Logout</a></li>
      </ul>
    </div>
  </nav>

  <div class="orders-container">
    <div class="orders-content">
      <div class="vendor-name" id="vendorNameDisplay">My Orders</div>

      

      
  

      <script>
        const vendorName = localStorage.getItem("vendorName");
      
        fetch(`/api/vendor-bookings?vendor_name=${encodeURIComponent(vendorName)}`)
          .then(res => res.json())
          .then(bookings => {
            const sections = {
              recent: '',
              pending: '',
              completed: ''
            };
      
            bookings.forEach(b => {
              const bookingInfo = `
                <div class="mb-3 p-2 bg-white rounded shadow">
                  <p><strong>Event:</strong> ${b.event_type} - ${b.event_date}</p>
                  <p><strong>Customer:</strong> ${b.booking_for}</p>
                  <p><strong>Email:</strong> ${b.email} | <strong>Phone:</strong> ${b.phone}</p>
                  ${b.status === 'pending' ? `
                    <input type="number" placeholder="Advance (₹)" id="advance-${b.id}" class="border p-1 rounded w-32 mb-2" />
                    <button class="bg-green-500 text-white px-2 py-1 rounded" onclick="confirmBooking(${b.id})">Confirm</button>
                  ` : `<p class="text-green-600">✅ Confirmed - Advance: ₹${b.advance_paid}</p>`}
                </div>
              `;
      
              if (b.status === 'pending') sections.pending += bookingInfo;
              else if (b.status === 'completed') sections.completed += bookingInfo;
              else sections.recent += bookingInfo;
            });
      
            document.querySelector(".section:nth-child(2) p").innerHTML = sections.recent;
            document.querySelector(".section:nth-child(3) p").innerHTML = sections.pending;
            document.querySelector(".section:nth-child(4) p").innerHTML = sections.completed;
          });
          
  function confirmBooking(bookingId) {
    const advanceAmount = document.getElementById(`advance-${bookingId}`).value;

    if (!advanceAmount || advanceAmount <= 0) {
      alert("Please enter a valid advance amount.");
      return;
    }

    fetch('/api/confirm-booking', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id: bookingId, advance_paid: advanceAmount })
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        alert("Booking confirmed!");
        location.reload();
      } else {
        alert("Error confirming booking.");
      }
    });
  }
</script>

      
      

</body>
</html>